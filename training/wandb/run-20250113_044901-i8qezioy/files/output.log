  0%|                                                                               | 0/120 [00:00<?, ?it/s]
0 58544 0.9606131315231323
1 58544 0.5178081393241882
2 58544 1.4843430519104004
3 58544 0.7783445119857788
4 58544 1.2241573333740234
5 58544 1.1829172372817993
6 58544 0.682408332824707
7 58544 1.050681233406067
8 58544 0.6868953108787537
9 58544 0.5123896598815918
10 58544 0.44727131724357605
11 58544 0.4053502678871155
12 58544 0.6880303025245667
13 58544 0.5241810083389282
14 58544 0.6484993100166321
15 58544 0.8338572978973389
16 58544 0.8577015995979309
17 58544 0.796908438205719
18 58544 0.7805535793304443
19 58544 0.5548658967018127
20 58544 0.5534168481826782
21 58544 0.5916441679000854
22 58544 0.2923901677131653
23 58544 0.6477494239807129
24 58544 0.4657498896121979
25 58544 0.4519321322441101
26 58544 0.6001061797142029
27 58544 0.3592587411403656
28 58544 0.4606079161167145
29 58544 0.4096841514110565
30 58544 0.3090992569923401
31 58544 0.41196271777153015
32 58544 0.36590999364852905
33 58544 0.40190234780311584
34 58544 0.38706842064857483
35 58544 0.43452218174934387
36 58544 0.452959805727005
37 58544 0.602009117603302
38 58544 0.6203184723854065
39 58544 0.5934500694274902
40 58544 0.49277421832084656
41 58544 0.3921930193901062
42 58544 0.3476790487766266
43 58544 0.27251335978507996
44 58544 0.3603112995624542
45 58544 0.3840612471103668
46 58544 0.3589906096458435
47 58544 0.45476797223091125
48 58544 0.3434699773788452
49 58544 0.300771027803421
50 58544 0.2417171150445938
51 58544 0.2697206139564514
52 58544 0.31599533557891846
53 58544 0.3606044352054596
54 58544 0.3722357749938965
55 58544 0.5556944608688354
56 58544 0.4279947876930237
57 58544 0.4268655478954315
58 58544 0.3730728328227997
59 58544 0.2756491005420685
60 58544 0.380084365606308
61 58544 0.337818443775177
62 58544 0.45247286558151245
63 58544 0.27722910046577454
64 58544 0.3405780494213104
65 58544 0.2331295907497406
66 58544 0.22135743498802185
67 58544 0.23805108666419983
68 58544 0.2934364974498749
69 58544 0.28259024024009705
70 58544 0.4236525297164917
71 58544 0.3868604600429535
72 58544 0.3158412575721741
73 58544 0.3724300265312195
74 58544 0.29952412843704224
75 58544 0.38188767433166504
76 58544 0.31155040860176086
77 58544 0.25901880860328674
78 58544 0.3102625608444214
79 58544 0.2699415683746338
80 58544 0.3162226974964142
81 58544 0.20115619897842407
82 58544 0.14460232853889465
83 58544 0.23854847252368927
84 58544 0.34522414207458496
85 58544 0.30770477652549744
86 58544 0.26240435242652893
87 58544 0.29575061798095703
88 58544 0.14762276411056519
89 58544 0.13352495431900024
90 58544 0.22889642417430878
91 58544 0.1987820267677307
92 58544 0.28083178400993347
93 58544 0.3691823482513428
94 58544 0.3695726692676544
95 58544 0.32243484258651733
96 58544 0.285096675157547
97 58544 0.5420882105827332
98 58544 0.5058081150054932
99 58544 0.43726709485054016
100 58544 0.3381040394306183
101 58544 0.2763020694255829
102 58544 0.24049900472164154
103 58544 0.23903463780879974
104 58544 0.3071874678134918
105 58544 0.200779989361763
106 58544 0.28062722086906433
107 58544 0.23696601390838623
108 58544 0.14923377335071564
109 58544 0.14877702295780182
110 58544 0.11716510355472565
111 58544 0.22573253512382507
112 58544 0.3710014224052429
113 58544 0.2280062586069107
114 58544 0.5192617177963257
115 58544 0.20628373324871063
116 58544 0.06173735484480858
117 58544 0.0
118 58544 0.09146280586719513
119 58544 0.20550261437892914
120 58544 0.30673715472221375
121 58544 0.0
122 58544 0.0
123 58544 0.11690627783536911
124 58544 0.1488676816225052
125 58544 0.10936423391103745
126 58544 0.04209883511066437
127 58544 0.0
128 58544 0.0668436661362648
129 58544 0.14826637506484985
130 58544 0.11641473323106766
131 58544 0.25972703099250793
132 58544 0.24829907715320587
133 58544 0.19640536606311798
134 58544 0.3498907685279846
135 58544 0.8349679112434387
136 58544 0.5728818774223328
137 58544 0.5575945377349854
138 58544 0.29526421427726746
139 58544 0.2107008397579193
140 58544 0.08688729256391525
141 58544 0.19272181391716003
142 58544 0.26328325271606445
143 58544 0.3311777412891388
144 58544 0.2660035192966461
145 58544 0.1173594668507576
146 58544 0.28895413875579834
147 58544 0.10468734055757523
148 58544 0.0
149 58544 0.04960213974118233
150 58544 0.9796444773674011
151 58544 0.49721190333366394
152 58544 0.5337205529212952
153 58544 0.31022611260414124
154 58544 0.0
155 58544 0.0
156 58544 0.0
157 58544 0.0
158 58544 0.23473966121673584
159 58544 0.11409170180559158
160 58544 0.03333421051502228
161 58544 0.1403401494026184
162 58544 0.5498582124710083
163 58544 0.3629162311553955
164 58544 0.5759963393211365
165 58544 0.11486533284187317
166 58544 0.13564351201057434
167 58544 0.0740123987197876
168 58544 0.29273104667663574
169 58544 0.1927456557750702
170 58544 0.24183861911296844
171 58544 0.09789809584617615
172 58544 0.1316545307636261
173 58544 0.06685956567525864
174 58544 0.0
175 58544 0.5083969235420227
176 58544 0.0
177 58544 0.1632884442806244
178 58544 0.0
179 58544 0.0
180 58544 0.004892781376838684
181 58544 0.0
182 58544 0.0
183 58544 0.0
184 58544 0.08690028637647629
185 58544 0.0
186 58544 0.0
187 58544 0.0
188 58544 0.0
189 58544 0.12264139205217361
190 58544 0.0
191 58544 0.0
192 58544 0.6140480637550354
193 58544 0.31270894408226013
194 58544 0.7199184894561768
195 58544 0.0
196 58544 0.14970166981220245
197 58544 0.08960597217082977
198 58544 0.2501416504383087
199 58544 0.2598407566547394
200 58544 0.2945910096168518
201 58544 0.1624491661787033
202 58544 0.10132427513599396
203 58544 0.0
204 58544 0.0
205 58544 1.027125358581543
206 58544 0.0
207 58544 0.07502448558807373
208 58544 0.0
209 58544 0.0
210 58544 0.0
211 58544 0.0
212 58544 0.0
213 58544 0.0
214 58544 0.0
215 58544 0.4616980254650116
216 58544 0.8887660503387451
217 58544 2.0257983207702637
218 58544 2.1714365482330322
219 58544 0.9313706755638123
220 58544 0.7999975681304932
221 58544 0.20993275940418243
222 58544 0.10303033888339996
223 58544 0.15953092277050018
224 58544 0.19678449630737305
225 58544 0.26370662450790405
226 58544 0.17006349563598633
227 58544 0.18511660397052765
228 58544 0.1652112752199173
229 58544 0.49271512031555176
230 58544 0.4971977174282074
231 58544 0.3272645175457001
232 58544 0.4484736919403076
233 58544 0.4623394012451172
234 58544 0.5195490717887878
235 58544 0.6407014727592468
236 58544 0.6464857459068298
237 58544 0.589900016784668
238 58544 0.4827709197998047
239 58544 0.3572864830493927
240 58544 0.2869580090045929
241 58544 0.2820655405521393
242 58544 0.2418840527534485
243 58544 0.22100067138671875
244 58544 0.1715487837791443
245 58544 0.17640230059623718
246 58544 0.23879007995128632
247 58544 0.24125073850154877
248 58544 0.4213428497314453
249 58544 0.3853907883167267
250 58544 0.28474223613739014
251 58544 0.2361852079629898
252 58544 0.24443387985229492
253 58544 0.2475644201040268
254 58544 0.2671094536781311
255 58544 0.32136499881744385
256 58544 0.38436001539230347
257 58544 0.29204806685447693
258 58544 0.4915672838687897
259 58544 0.44226542115211487
260 58544 0.19043147563934326
261 58544 0.14591968059539795
262 58544 0.14154261350631714
263 58544 0.17067210376262665
264 58544 0.3386077284812927
265 58544 0.7090530395507812
266 58544 0.22427982091903687
267 58544 0.1544896364212036
268 58544 0.17373092472553253
269 58544 0.1622326523065567
270 58544 0.18076574802398682
271 58544 0.5842182040214539
272 58544 0.5364517569541931
273 58544 0.4587844908237457
274 58544 0.1384410709142685
275 58544 0.31825774908065796
276 58544 0.3379327356815338
277 58544 0.38188880681991577
278 58544 0.4333631098270416
279 58544 0.21097655594348907
280 58544 0.38756129145622253
281 58544 0.6120566129684448
282 58544 0.34173107147216797
283 58544 0.47492456436157227
284 58544 0.22110985219478607
285 58544 0.23827244341373444
286 58544 0.18222366273403168
287 58544 0.27724114060401917
288 58544 0.22117294371128082
289 58544 0.30420181155204773
290 58544 0.5588061809539795
291 58544 0.4079996943473816
292 58544 0.41063782572746277
293 58544 0.48316094279289246
294 58544 0.45337507128715515
295 58544 0.43127667903900146
296 58544 0.40331441164016724
297 58544 0.3453333377838135
298 58544 0.29516711831092834
299 58544 0.4559483230113983
300 58544 0.25875166058540344
301 58544 0.2207993119955063
302 58544 0.41598060727119446
303 58544 0.21952393651008606
304 58544 0.29084962606430054
305 58544 0.3550739884376526
306 58544 0.30139967799186707
307 58544 0.3722185790538788
308 58544 0.3281102776527405
309 58544 0.3042871356010437
310 58544 0.2606542110443115
311 58544 0.16923144459724426
312 58544 0.2814110219478607
313 58544 0.31472423672676086
314 58544 0.19670140743255615
315 58544 0.15300336480140686
316 58544 0.20421940088272095
317 58544 0.15642309188842773
318 58544 0.13044139742851257
319 58544 0.17925088107585907
320 58544 0.15447676181793213
321 58544 0.1797223538160324
322 58544 0.264687180519104
323 58544 0.2025088667869568
324 58544 0.1583012044429779
325 58544 0.11003711819648743
326 58544 0.14808999001979828
327 58544 0.19883441925048828
328 58544 0.24512478709220886
329 58544 0.16319973766803741
330 58544 0.17791905999183655
331 58544 0.2962051331996918
332 58544 0.1465197205543518
333 58544 0.177622452378273
334 58544 0.17042990028858185
335 58544 0.17709234356880188
336 58544 0.16887013614177704
337 58544 0.13125666975975037
338 58544 0.118612140417099
339 58544 0.16168631613254547
340 58544 0.10971179604530334
341 58544 0.16715717315673828
342 58544 0.053501881659030914
343 58544 0.0
344 58544 0.0
345 58544 0.0
346 58544 0.0
347 58544 0.07609327137470245
348 58544 0.36776140332221985
349 58544 0.8549531698226929
350 58544 0.16467417776584625
351 58544 0.1539669930934906
352 58544 0.3106938898563385
353 58544 0.13717854022979736
354 58544 0.5651193261146545
355 58544 0.47415927052497864
356 58544 0.7165542840957642
357 58544 0.7627508640289307
358 58544 0.9175944328308105
359 58544 0.3666362464427948
360 58544 0.15965858101844788
361 58544 0.10158977657556534
362 58544 0.08421311527490616
363 58544 0.22317446768283844
364 58544 0.22281360626220703
365 58544 0.0782320499420166
366 58544 0.3940257430076599
367 58544 0.13913129270076752
368 58544 0.3931425213813782
369 58544 0.07819203287363052
370 58544 0.44620394706726074
371 58544 0.753668487071991
372 58544 0.6381461024284363
373 58544 0.23658913373947144
374 58544 0.16235171258449554
375 58544 0.14774774014949799
376 58544 0.14724943041801453
377 58544 0.2082425206899643
378 58544 0.21432176232337952
379 58544 0.3823069632053375
380 58544 0.3487681448459625
381 58544 0.8974186778068542
382 58544 0.21242207288742065
383 58544 0.34233948588371277
384 58544 0.5507784485816956
385 58544 0.3107723295688629
386 58544 0.20936690270900726
387 58544 0.36322399973869324
388 58544 0.22453181445598602
389 58544 0.31981489062309265
390 58544 0.42106369137763977
train - Global loss: 0.316810    Embedding norm: 12.5130   Triplets (all/active): 149.7/13773.0
Pos dist (min/mean/max): 1.2337/1.5946/3.1646   Neg dist (min/mean/max): 1.5856/2.3805/4.4961
0 19297 0.9894217252731323
1 19297 0.952841579914093
2 19297 1.049241304397583
3 19297 1.0275579690933228
4 19297 1.2122247219085693
5 19297 0.8243028521537781
6 19297 0.6893894076347351
7 19297 0.915799617767334
8 19297 1.0086928606033325
9 19297 0.8022649884223938
Traceback (most recent call last):
  File "/code/RLoc/training/train.py", line 31, in <module>
    do_train(params, debug=args.debug, device=device)
  File "/code/RLoc/training/trainer.py", line 356, in do_train
    for index, (query, positives, negatives) in enumerate(dataloaders[phase]):
  File "/usr/local/lib/python3.9/site-packages/torch/utils/data/dataloader.py", line 681, in __next__
    data = self._next_data()
  File "/usr/local/lib/python3.9/site-packages/torch/utils/data/dataloader.py", line 721, in _next_data
    data = self._dataset_fetcher.fetch(index)  # may raise StopIteration
  File "/usr/local/lib/python3.9/site-packages/torch/utils/data/_utils/fetch.py", line 49, in fetch
    data = [self.dataset[idx] for idx in possibly_batched_index]
  File "/usr/local/lib/python3.9/site-packages/torch/utils/data/_utils/fetch.py", line 49, in <listcomp>
    data = [self.dataset[idx] for idx in possibly_batched_index]
  File "/code/RLoc/training/dataset.py", line 87, in __getitem__
    selected_pos_indices = np.random.choice(pos_indices,  size=3, replace=len(pos_indices) < 3)  # Select n_pos=3
  File "mtrand.pyx", line 934, in numpy.random.mtrand.RandomState.choice
ValueError: 'a' cannot be empty unless no samples are taken
